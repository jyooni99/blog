---
title: "iOS 웹 푸시 제약과 PWA 설치 과정"
description: "iOS 환경에서 웹 푸시 알림 권한 요청이 동작하지 않았던 원인을 분석하고, PWA를 설치하는 과정을 정리했습니다."
date: "2025-03-20"
tags: ["Quick Network", "PWA", "iOS", "Web Push"]
published: true
coverImage: "/posts/qn-why-choosing-pwa/ios-web-push-success.png"
---

## iOS에서 푸시 알림이 안 와요!

Quick Network는 대형 컨퍼런스 현장에서 참가자 간 실시간 매칭을 돕는 서비스입니다.
서비스의 핵심 가치는 사용자가 사이트에 접속하지 않은 상태에서도 매칭 이벤트를 즉시 인지할 수 있도록 하는 것이었고,
이를 위해 푸시 알림 도입을 결정했습니다. (참고: [푸시 알림을 선택한 이유](./qn-why-choosing-push.mdx))

여러 블로그를 참고해 안드로이드와 macOS 환경에서는 푸시 알림을 정상적으로 구현할 수 있었지만, iOS 환경에서는 권한 요청 팝업조차 표시되지 않는 문제가 발생했습니다.

### 권한 팝업이 뜨지 않는 것이 왜 문제일까?

이 문제를 이해하기 위해서는 FCM의 기본 동작 흐름을 살펴볼 필요가 있습니다.

1. 사용자가 푸시 알림 권한 요청을 수락합니다.
2. 권한이 수락되면 FCM SDK가 토큰을 요청하고, FCM 토큰이 발급됩니다.
3. 클라이언트에서는 발급된 FCM 토큰을 서버에 전달합니다.
4. 푸시 알림 이벤트가 발생하면 서버는 저장된 FCM 토큰을 기준으로 FCM 서버에 알림 전송을 요청합니다.
5. FCM 서버는 해당 토큰을 가진 디바이스로 푸시 알림을 전송합니다.

이 흐름에서 알 수 있듯이, **권한 요청 팝업이 표시되지 않으면 토큰 발급 자체가 불가능**합니다.
따라서 푸시 알림을 구현하기 위해서는 해당 문제의 원인을 먼저 파악해야 했습니다.

## webkit 환경에서의 푸시 알림 제약

macOS에서는 정상적으로 동작했지만, iOS에서는 동작하지 않았기 때문에 iOS에만 존재하는 제약이 있을 것으로 판단했습니다.
따라서, 먼저 Apple 공식 문서 [Sending web push notifications in web apps and browsers](https://developer.apple.com/documentation/usernotifications/sending-web-push-notifications-in-web-apps-and-browsers)를 확인했습니다.

문서에 따르면, 웹 푸시 알림은 아래 환경에서만 사용할 수 있습니다.

> When important, time-sensitive events occur, inform your website users with push notifications you send from your server.
> To do this, add support for web push — push notifications that use the cross-browser Push API, Notifications API, Badging API, and Service Worker standards.
> For more information on these standards, see the W3C document on Push API standards.
> **Add web push to Home Screen web apps in iOS 16.4 or later and Webpages in Safari 16 for macOS 13 or later.**

macOS의 경우 Safari 16 이상이라면 일반 웹 페이지에서도 웹 푸시를 받을 수 있어 정상적으로 동작했던 것이고,
iOS에서는 **iOS 16.4 이상에서 홈 화면에 추가된 웹 앱(PWA) 형태로 실행**되는 경우에만 웹 푸시 알림을 사용할 수 있어 동작하지 않았던 것 이었습니다.

이 외에도 푸시 알림 권한 요청에 대한 조건이 있었습니다.

> Ask the user for permission to send them push notifications. Provide a method for the user to grant permission with a gesture, such as clicking or tapping a button. When the user completes the gesture, call the push subscription method immediately from the gesture’s event handler code.\*\*

**푸시 알림 권한 요청은 반드시 사용자의 명시적인 액션(클릭, 탭 등)을 통해 이루어져야 하며,** 페이지 진입 시 자동으로 권한 요청을 시도하는 방식은 허용되지 않습니다.

따라서 iOS 환경에서 푸시 알림을 구현하기 위해서는 PWA로 전환을 해야만 했습니다.

## PWA란?

`PWA(Progressive Web App)`는 **웹 앱의 장점(접근성)과 네이티브 앱의 장점(기능,성능)을 결합한 웹 애플리케이션**입니다.
따라서 사용자가 앱을 다운로드하거나 업데이트 할 필요 없이 홈 화면에 앱처럼 설치하여 사용 가능하며, 웹 기술을 기반으로 구현하기 때문에 **기존 웹 코드를 그대로 사용하여 구현 가능**합니다.

## Next.js PWA 적용 과정

처음에는 `next-pwa` 라이브러리를 사용하여 PWA를 적용하려 했지만, 3년 째 업데이트가 중단된 상태였고, App Router 환경에서 안정성이 보장되지 않았습니다.
따라서 유지보수가 활발한 [@ducanh2912/next-pwa](https://www.npmjs.com/package/@ducanh2912/next-pwa) 라이브러리를 사용하게 되었습니다.
공식 문서도 정리가 잘 되어 있어, PWA를 처음 적용해보았음에도 큰 어려움 없이 진행할 수 있었습니다.

> [@ducanh2912/next-pwa 공식 문서](https://ducanh-next-pwa.vercel.app/)

### 1. 설치 및 next.config.ts 설정

`@ducanh2912/next-pwa` 라이브러리를 설치해주고

```bash
npm i @ducanh2912/next-pwa && npm i -D webpack
```

`next.config.ts`에서 `withPWAInit`으로 감싸주면 끝입니다.

```typescript
import type { NextConfig } from "next";
import withPWAInit from "@ducanh2912/next-pwa";

const withPWA = withPWAInit({
  dest: "public",
});

const nextConfig: NextConfig = {
  /* config options here */
};

export default withPWA(nextConfig);
```

빌드(`npm run build`)를 완료하면 `public` 폴더에 `sw.js`와 `workbox-\*.js` 파일이 자동 생성됩니다.

<img
  src="/posts/qn-why-choosing-pwa/sw-and-workbox.png"
  alt="sw.js와 workbox-\*.js 파일 생성"
  width={552}
  height={172}
/>

### 2. manifest.json 작성

manifest.json은 PWA 앱 정보를 브라우저에 제공하는 JSON 파일입니다.

- App Router → app 폴더
- Page Router → public 폴더

저는 App Router를 사용하므로 `app` 폴더에 `manifest.json`을 저장했습니다.

```json
{
  "short_name": "Quick Network",
  "name": "Quick Network",
  "description": "대규모 IT 행사 참가자를 위한 즉석 네트워킹 및 온라인 명함 교환 서비스",
  "start_url": "/",
  "display": "standalone",
  "theme_color": "#000000",
  "background_color": "#ffffff",
  "icons": [
    {
      "src": "/images/icons/icon-128.png",
      "sizes": "128x128",
      "type": "image/png"
    },
    {
      "src": "/images/icons/icon-512.png",
      "sizes": "512x512",
      "type": "image/png"
    }
  ]
}
```

### 3. Layout.tsx에 메타 태그 적용

마지막으로 App Router 바로 아래의 `layout.tsx`에 메타 태그를 적용시켜주면 초기 설정은 마무리가 됩니다.

```typescript
import '~/styles/globals.css';
import type { Metadata, Viewport } from 'next';

const APP_NAME = 'Quick Network';
const APP_DEFAULT_TITLE = 'Quick Network';
const APP_TITLE_TEMPLATE = '%s - Quick Network';

export const metadata: Metadata = {
  applicationName: APP_NAME,
  title: {
    default: APP_DEFAULT_TITLE,
    template: APP_TITLE_TEMPLATE,
  },
  description: APP_DESCRIPTION,
  manifest: '/manifest.json',
  appleWebApp: {
    capable: true,
    statusBarStyle: 'default',
    title: APP_DEFAULT_TITLE,
  },
  formatDetection: {
    telephone: false,
  },
  openGraph: {
    type: 'website',
    siteName: APP_NAME,
    title: {
      default: APP_DEFAULT_TITLE,
      template: APP_TITLE_TEMPLATE,
    },
    description: APP_DESCRIPTION,
  },
  twitter: {
    card: 'summary',
    title: {
      default: APP_DEFAULT_TITLE,
      template: APP_TITLE_TEMPLATE,
    },
    description: APP_DESCRIPTION,
  },
};

export const viewport: Viewport = {
  themeColor: '#FFFFFF',
};

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  return (
    <html lang="en">
    <body className="min-h-screen">{children}</body>
  </html>
}
```

### 4. PWA 적용 확인

`Application` 탭에서 `Manifest`가 출력되면 정상적으로 PWA가 적용된 것입니다.

<img
  src="/posts/qn-why-choosing-pwa/pwa-build.png"
  alt="PWA 적용 확인"
  width={1000}
  height={800}
/>

## iOS 테스트 알림 성공!

iOS 환경에서도 동일하게 테스트를 진행해보았습니다.

먼저 웹 페이지로 이동해, 홈 화면에 추가를 눌러주면 홈 화면에 아이콘이 추가됩니다.

<div className="flex gap-4 my-4 w-full items-start">
  <img
    src="/posts/qn-why-choosing-pwa/ios-pwa.png"
    alt="ios에서 홈화면에 추가한 PWA 앱"
    className="flex-1 min-w-0 h-auto object-contain"
  />

  <img
    src="/posts/qn-why-choosing-pwa/ios-pwa-init.png"
    alt="ios에서 홈화면에 추가하기"
    className="flex-1 min-w-0 h-auto object-contain"
  />
</div>

알림 팝업을 수락해주면 테스트 알림이 정상적으로 수신됩니다.

<img
  src="/posts/qn-why-choosing-pwa/ios-web-push-success.png"
  alt="iOS 테스트 알림 성공!"
  width={1170}
  height={1300}
/>

PWA로 전환한 이후 iOS 사용자도 정상적으로 매칭 알림 수신할 수 있게 되었고, **알림이 오면 바로 서비스로 이동해서 매칭을 이어가는 플로우**를 유지할 수 있게 되었습니다.

## 마치며

iOS 웹 푸시 제약은 버그가 아닌 플랫폼 정책의 문제였고. 이를 해결하기 위해서는 PWA 전환이 필수적이었습니다.

이번 경험을 통해 여러 플랫폼에서 동일한 경험을 제공하는 것이 생각보다 단순하지 않다는 것을 알게 되었고, 기술을 선택하기 전에 각 플랫폼이 가지고 있는 제약을 먼저 이해하는 과정이 필요하다는 점을 체감할 수 있었습니다.
